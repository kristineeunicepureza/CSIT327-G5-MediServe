{% extends 'base.html' %}
{% load static %}

{% block title %}Order History{% endblock %}

{% block content %}

    <div style="width: 100%; max-width: 100vw; margin: 0; background-color: #FFFFFF; border-radius: 0; box-shadow: none;">

        {# HEADER BAR #}
        <header style="padding: 15px 30px; border-bottom: 1px solid #ddd; display: flex; align-items: center;">
            <a href="{% url 'main_menu' %}" class="btn" style="
                padding: 8px 10px;
                margin-right: 15px;
                background-color: #f7f9fa;
                color: #36489e;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                justify-content: center;
                align-items: center;
                border: 1px solid #ddd;
                box-shadow: none;
            ">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1 style="font-size: 1.5em; color: #36489e;">Order History</h1>
        </header>

        {# MAIN HISTORY CONTENT #}
        <main style="padding: 30px;">
            <p style="color: #555; margin-bottom: 20px;">A list of your completed and processed orders.</p>

            {# HISTORY TOOLS (Integrated into main view) #}
            <div class="history-tools" style="display: flex; gap: 15px; margin-bottom: 30px;">
                <button class="btn" style="background-color: #ddd; color: #333; cursor: not-allowed; padding: 10px 15px;">
                    <i class="fas fa-calendar-alt"></i> Filter by Date
                </button>
                <button class="btn" style="background-color: #ddd; color: #333; cursor: not-allowed; padding: 10px 15px;">
                    <i class="fas fa-search"></i> Search Orders
                </button>
            </div>

            <div class="history-list-view" style="width: 100%; display: flex; flex-direction: column; gap: 20px;">

                {% for order in past_orders %}
                    <div class="history-card" style="
                        background-color: #FFFFFF;
                        padding: 20px;
                        border-radius: 8px;
                        border: 1px solid #ddd;
                        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                    ">

                        {# ORDER SUMMARY HEADER #}
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee;">

                            <div style="flex-grow: 1;">
                                <strong style="font-size: 1.2em; color: #36489e;">Order #{{ order.id }}</strong>
                                <p style="font-size: 0.85em; color: #777; margin: 0;">
                                    Placed: {{ order.created_at|date:"M d, Y" }} |
                                    Completed: {{ order.completed_at|date:"M d, Y" }}
                                </p>
                            </div>

                            <div style="text-align: right;">
                                <strong style="font-size: 1.1em; color: #28a745;">
                                    {{ order.get_total_quantity }} items
                                </strong>
                            </div>
                        </div>

                        {# ORDER ITEMS #}
                        <div style="margin-bottom: 15px;">
                            <h4 style="color: #36489e; margin-bottom: 10px;">Items:</h4>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                {% for item in order.items.all %}
                                    <li style="padding: 5px 0; border-bottom: 1px solid #f0f0f0;">
                                        <strong>{{ item.medicine.name }}</strong>
                                        {% if item.medicine.brand %}({{ item.medicine.brand }}){% endif %}
                                        - Quantity: <span style="color: #dc3545;">{{ item.quantity }}</span>
                                        {% if item.special_request %}
                                            <br><small style="color: #6c757d; font-style: italic;">Note: {{ item.special_request }}</small>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>

                        {# STATUS AND ACTION FOOTER #}
                        <div style="display: flex; justify-content: space-between; align-items: center;">

                            <span style="font-weight: bold; font-size: 1em; padding: 5px 10px; border-radius: 4px;
                                color: #FFFFFF; background-color: #28a745;
                            ">
                                {{ order.status }}
                            </span>

                            <div style="display: flex; gap: 10px;">
                                {% if order.queue_number %}
                                    <span style="font-size: 0.9em; color: #6c757d;">
                                        Queue #{{ order.queue_number }}
                                    </span>
                                {% endif %}
                                <a href="{% url 'track_delivery' %}" class="btn" style="
                                    background-color: #5c74e3;
                                    color: #FFFFFF;
                                    padding: 8px 15px;
                                    font-size: 0.9em;
                                    text-decoration: none;
                                ">
                                    <i class="fas fa-truck"></i> Track Orders
                                </a>
                            </div>
                        </div>

                    </div>
                {% empty %}
                    <div style="text-align: center; padding: 60px; border: 1px solid #ddd; border-radius: 8px; background-color: #f8f9fa;">
                        <div style="font-size: 3em; color: #dee2e6; margin-bottom: 15px;">
                            <i class="fas fa-history"></i>
                        </div>
                        <h3 style="color: #6c757d; margin-bottom: 10px;">No Order History</h3>
                        <p style="color: #6c757d;">You have no completed orders yet.</p>
                        <a href="{% url 'medicine_list' %}" class="btn" style="
                            background-color: #36489e;
                            color: #FFFFFF;
                            padding: 12px 24px;
                            margin-top: 20px;
                            text-decoration: none;
                            border-radius: 5px;
                        ">
                            <i class="fas fa-pills"></i> Browse Medicines
                        </a>
                    </div>
                {% endfor %}

            </div>
        </main>
    </div>
{% endblock %}